
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>成語填空挑戰</title>
    <!-- 載入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 設定字體為 Inter，但主要中文字體使用系統預設，確保顯示效果 */
        :root {
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
        }
        /* 自定義按鈕樣式 */
        .option-button {
            transition: all 0.15s ease-in-out;
        }
        .option-button:hover:not(.disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        /* 替換成語的方框樣式 */
        .idiom-box {
            display: inline-block;
            width: 1.5rem; /* 方框寬度 */
            height: 1.5rem; /* 方框高度 */
            border: 2px solid #ef4444; /* 紅色邊框 */
            margin: 0 0.1rem;
            text-align: center;
            line-height: 1.5rem;
            font-weight: bold;
            color: #ef4444;
            background-color: #fee2e2; /* 淺紅色背景 */
            border-radius: 4px;
        }
        /* 成功填入的成語樣式 */
        .idiom-filled {
            color: #10b981; /* 綠色文字 */
            font-weight: bold;
            margin: 0 0.25rem;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 sm:p-8">

    <div id="app" class="max-w-4xl mx-auto bg-white shadow-2xl rounded-xl p-6 md:p-10 border-t-8 border-red-500">
        <h1 class="text-3xl font-extrabold text-gray-800 mb-6 text-center">📚 成語填空挑戰 📚</h1>

        <!-- 步驟 1: 選擇課別 -->
        <div id="lesson-selection" class="space-y-4">
            <h2 class="text-xl font-semibold text-red-600 mb-3 border-b pb-2">步驟一：選擇挑戰課別</h2>
            <div id="lesson-buttons" class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                <!-- Lesson buttons will be injected here -->
            </div>
        </div>

        <!-- 步驟 2: 挑戰介面 (預設隱藏) -->
        <div id="challenge-area" class="mt-8 hidden space-y-6">
            <h2 class="text-xl font-semibold text-red-600 mb-3 border-b pb-2">步驟二：完成挑戰</h2>
            
            <!-- 成語解釋區塊 (新增) -->
            <div class="bg-blue-50 p-4 rounded-lg shadow-inner border-l-4 border-blue-500">
                <p id="current-lesson" class="text-lg font-medium text-red-700 mb-2"></p>
                <p class="text-md text-blue-800 leading-relaxed">
                    <span class="font-bold text-blue-600 mr-2">💡 解釋：</span>
                    <span id="idiom-explanation" class="font-normal italic"></span>
                </p>
            </div>
            
            <!-- 造句區塊 (更新) -->
            <div class="bg-red-50 p-4 rounded-lg shadow-inner">
                <p class="text-2xl text-gray-800 leading-relaxed tracking-wider">
                    <span class="font-bold text-red-500 mr-2">造句：</span>
                    <span id="question-sentence" class="font-normal"></span>
                </p>
            </div>

            <div id="feedback-area" class="min-h-[6rem] flex flex-col items-center justify-center">
                <!-- Feedback/Success message goes here -->
                <p id="message" class="text-xl font-bold text-gray-600">請從下方選項選出正確成語。</p>
            </div>
            
            <!-- 語音按鈕 -->
            <div id="speech-controls" class="w-full text-center hidden">
                <button id="speak-button" class="bg-yellow-500 text-white font-bold py-2 px-4 rounded-full shadow-lg hover:bg-yellow-600 transition-colors flex items-center justify-center mx-auto" onclick="speakIdiom()">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 3v14a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 00.09-.217zM14.546 12.441a5.986 5.986 0 000-4.882 1 1 0 011.892.61c.142.66.216 1.334.216 2.015s-.074 1.355-.216 2.015a1 1 0 01-1.892.61z" clip-rule="evenodd" />
                    </svg>
                    朗讀成語
                </button>
                <p class="text-sm text-gray-500 mt-1">（使用瀏覽器內建語音）</p>
            </div>


            <div id="options-area" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <button class="option-button bg-red-500 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed" onclick="checkAnswer(this)" data-answer=""></button>
                <button class="option-button bg-red-500 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed" onclick="checkAnswer(this)" data-answer=""></button>
                <button class="option-button bg-red-500 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed" onclick="checkAnswer(this)" data-answer=""></button>
            </div>

            <button id="next-button" class="w-full bg-green-500 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-green-600 transition-colors hidden disabled:opacity-50" onclick="nextQuestion()">下一題挑戰</button>
        </div>
    </div>

    <script>
        // =========================================================================
        // 核心資料庫: 1-12 課的成語及其造句與解釋 (已加入解釋)
        // [成語] 是替換用的 Placeholder
        // =========================================================================

        const idiomData = {
            "第一課 我的心情": [
                { idiom: "難能可貴", explanation: "做到了不容易做到的事，所以特別珍貴。", sentence: "他小小年紀就懂得幫忙做家事，真是[成語]。" },
                { idiom: "愛屋及烏", explanation: "比喻愛一個人，也連帶關愛和他有關係的所有事。", sentence: "我喜歡和他一起玩，[成語]，也喜歡和他的妹妹一起玩。" },
                { idiom: "行雲流水", explanation: "形容待人處事或文章字畫生動流暢，沒有拘束。", sentence: "這首歌的節奏自然順暢，有如[成語]，大家都喜歡聽。" },
                { idiom: "開誠布公", explanation: "坦白、誠懇的說出自己的意見。", sentence: "我希望你們[成語]的說一說，來化解彼此的誤會。" },
                { idiom: "心花怒放", explanation: "形容心裡非常高興、快樂。", sentence: "弟弟真誠的讚美，讓媽媽[成語]。" },
                { idiom: "現身說法", explanation: "以親身經驗為例證，向人講解說明。", sentence: "老師請跳繩得獎的人[成語]，告訴大家練習的好方法。" }
            ],
            "第二課 彩色的天空": [
                { idiom: "老馬識途", explanation: "比喻有經驗的人，可帶領人走上正確的道路。", sentence: "小張常到日本旅遊，這次有他[成語]的帶領下，一定玩得很盡興。" },
                { idiom: "耳目一新", explanation: "聽到的、看到的都有一種新穎、清爽的感覺。", sentence: "這座兒童樂園經過整修後，讓人感到[成語]。" },
                { idiom: "守望相助", explanation: "互相照應，共同防範、抵禦，以維護團體或地方的安寧。", sentence: "同學們要[成語]，可以幫助別人，也可以幫助自己。" },
                { idiom: "有始有終", explanation: "有開頭有結尾。指做事能貫徹到底。", sentence: "班長做事認真負責，總是能[成語]的完成，我要向他學習。" },
                { idiom: "不知所措", explanation: "形容不知道怎麼辦才好。", sentence: "遇到地震要保持冷靜，才不會[成語]。" },
                { idiom: "志同道合", explanation: "志向相同，意見相合。", sentence: "多參加各種活動，就可以找到[成語]的朋友。" }
            ],
            "第三課 國王做新衣": [
                { idiom: "畫龍點睛", explanation: "比喻繪畫、作文、講話在關鍵處加上精采的一筆，使內容生動。", sentence: "這幅畫有了他[成語]的一筆，看起來更漂亮了！" },
                { idiom: "改頭換面", explanation: "徹底改變外觀，有重新做人的意思。", sentence: "他已經[成語]，努力做好事，我們應該給他鼓勵和機會。" },
                { idiom: "千方百計", explanation: "想盡或用盡一切方法。", sentence: "為了解決眼前的難題，我們用盡了[成語]，希望最後可以成功。" },
                { idiom: "百發百中", explanation: "形容射箭或射擊非常準確，每發必中。", sentence: "只見他反身跳投，又進了，真是[成語]！" },
                { idiom: "約法三章", explanation: "事先約定幾條主要的規定，大家共同遵守。", sentence: "我和媽媽[成語]，在公園玩到五點就會回家。" },
                { idiom: "四分五裂", explanation: "形容分散、不完整，支離破碎。", sentence: "小組因為意見不同吵了起來，變得[成語]。" }
            ],
            "第四課 水草下的呱呱": [
                { idiom: "有聲有色", explanation: "形容敘述、表演生動逼真，內容精采。", sentence: "他們把故事說得[成語]，大家聽完都為他們鼓掌。" },
                { idiom: "形影不離", explanation: "形容關係親密，無時無刻不在一起。", sentence: "姐姐和她的好朋友總是[成語]，像是親姐妹一樣。" },
                { idiom: "別開生面", explanation: "另創一種新局面、新風格。", sentence: "這場[成語]的棒球音樂會，有精彩的歌曲和表演，讓大家跟著音樂又唱又跳。" },
                { idiom: "易如反掌", explanation: "比喻事情非常容易，毫不費力。", sentence: "他的力氣很大，抬起書櫃是[成語]的事。" },
                { idiom: "明知故犯", explanation: "明明知道不對或不能做，卻故意去做。", sentence: "弟弟[成語]，又做錯事了，讓媽媽不知道該拿他怎麼辦?" },
                { idiom: "一成不變", explanation: "一點也沒有改變。", sentence: "爸爸做事有個[成語]的原則，就是認真負責。" }
            ],
            "第五課 沙灘上的畫": [
                { idiom: "聚沙成塔", explanation: "比喻積少成多。", sentence: "只要我們努力，[成語]，成功就在眼前。" },
                { idiom: "天涯海角", explanation: "形容極遠的地方。", sentence: "有了手機，就算[成語]，我們都能聯絡對方。" },
                { idiom: "知難而退", explanation: "知道事情困難就退縮，沒有勇氣面對。", sentence: "他分享自己成功的方法，就是要努力向前，不能有[成語]的想法。" },
                { idiom: "一朝一夕", explanation: "形容很短暫的時間。", sentence: "畫圖要畫得好，不是[成語]就能達成，要經過長時間的練習。" },
                { idiom: "腳踏實地", explanation: "比喻做事認真、實在。", sentence: "他透過[成語]的練習，才贏得比賽。" }
            ],
            "第六課 草叢裡的星星": [
                { idiom: "粗茶淡飯", explanation: "指簡單的飯食。", sentence: "鄰居的老夫婦每天都是[成語]，過著簡單的生活。" },
                { idiom: "胸有成竹", explanation: "比喻事先已有了準備或計劃。", sentence: "哥哥[成語]的去比賽，果然拿回好成績。" },
                { idiom: "頭頭是道", explanation: "形容說話有條理，脈絡清楚。", sentence: "他講得[成語]，最後大家都同意採用他的意見。" },
                { idiom: "袖手旁觀", explanation: "比喻置身事外，不予過問或幫助。", sentence: "大家忙成一團，她卻沒事情做，[成語]的站在那裡。" },
                { idiom: "目不轉睛", explanation: "形容注目凝視，專心觀看。", sentence: "看著廣場上奇幻的魔術表演，遊客們[成語]，就怕錯過精彩的演出。" }
            ],
            "第七課 不一樣的美食": [
                { idiom: "裝模作樣", explanation: "故意做出某種姿態，以引人注意或炫耀自己。", sentence: "他[成語]的道歉，很難讓人原諒他。" },
                { idiom: "生龍活虎", explanation: "形容活潑矯健，充滿活力。", sentence: "球場上的同學們，個個[成語]，非常有活力的樣子。" },
                { idiom: "出奇制勝", explanation: "用奇特的辦法取得勝利。", sentence: "這次球賽，教練的戰略[成語]，我們終於贏得冠軍。" },
                { idiom: "節外生枝", explanation: "比喻在主要問題之外，又發生了新的問題。", sentence: "這消息越多人知道，越會[成語]。" },
                { idiom: "風平浪靜", explanation: "形容沒有風浪，水面平靜。", sentence: "這件事總算[成語]的過去了。" },
                { idiom: "安分守己", explanation: "守住本分，不做違法亂紀的事。", sentence: "他經過這次可怕的事件，終於知道[成語]了。" }
            ],
            "第八課 美食分享日": [
                { idiom: "得意忘形", explanation: "形容高興得失去常態，舉止輕狂。", sentence: "弟弟剛學會騎腳踏車就[成語]的放開把手，差點摔倒。" },
                { idiom: "紙上談兵", explanation: "比喻不切實際的空談。", sentence: "這些想法都只是[成語]，我們還是要動手做以後，才能發現問題。" },
                { idiom: "千變萬化", explanation: "形容變化極多。", sentence: "這裡施放的煙火，花樣[成語]，看起來真是美麗!" },
                { idiom: "各有千秋", explanation: "比喻各有長處，不分高下。", sentence: "這兩名選手的跳水動作[成語]，裁判很難決定冠軍。" },
                { idiom: "移花接木", explanation: "比喻暗中更換事物，欺騙他人。", sentence: "王先生買的上等櫻桃，不知什麼時候被[成語]，變成葡萄了!" },
                { idiom: "言聽計從", explanation: "形容對某人非常信任，完全聽從他的話。", sentence: "李經理很信任他的助理，對他總是[成語]。" }
            ],
            "第九課 好味道": [
                { idiom: "古道熱腸", explanation: "形容待人誠懇、熱心。", sentence: "黃里長總是那麼[成語]，待人誠懇又熱心。" },
                { idiom: "水深火熱", explanation: "比喻生活極端困苦。", sentence: "戰亂中的國家，人民通常都過著[成語]的日子。" },
                { idiom: "蒸蒸日上", explanation: "形容事業不斷向上發展。", sentence: "在他的努力經營下，公司業績[成語]。" },
                { idiom: "名不虛傳", explanation: "名聲與實際相符，一點也沒有誇大。", sentence: "親眼看到陽明山百花齊開的景色，果然[成語]啊!" },
                { idiom: "四通八達", explanation: "形容交通便利。", sentence: "這裡的交通[成語]，要到各個景點都很方便。" },
                { idiom: "細水長流", explanation: "比喻節省、積蓄，可長久使用。", sentence: "每日存下一點小錢，[成語]，也會累積成一筆財富。" }
            ],
            "第十課 加加減減": [
                { idiom: "虛有其表", explanation: "空有華麗的外表，內在卻很空虛。", sentence: "別看他說得頭頭是道，其實什麼也不懂，只是[成語]罷了。" },
                { idiom: "對答如流", explanation: "形容回答問題流暢、快速。", sentence: "小明對老師的提問，總是[成語]，真厲害。" },
                { idiom: "七嘴八舌", explanation: "形容人多嘴雜，議論紛紛。", sentence: "今天班會討論慶生會的活動，同學們[成語]的爭相提出意見。" },
                { idiom: "異想天開", explanation: "不符實際、不合事理的奇特想法。", sentence: "因為萊特兄弟的[成語]，最後竟然實現了人類飛行的美夢。" },
                { idiom: "守口如瓶", explanation: "嘴像瓶口一樣封得嚴緊，比喻嚴守祕密。", sentence: "媽媽[成語]，一直不告訴我生日禮物是什麼。" },
                { idiom: "對牛彈琴", explanation: "比喻對不懂道理的人講道理，白費口舌。", sentence: "跟他講道理，就像[成語]，還是別浪費時間吧!" }
            ],
            "第十一課 奇怪的門": [
                { idiom: "少見多怪", explanation: "很少見到就覺得奇怪。", sentence: "這種事經常發生，沒什麼稀奇，你就別[成語]了。" },
                { idiom: "坐立不安", explanation: "形容心情緊張，坐著站著都不安寧。", sentence: "等一下就要公布得獎名單了，大家都開始[成語]。" },
                { idiom: "天馬行空", explanation: "比喻文章、書法、言語、想像等氣勢豪邁，不受拘束。", sentence: "這本故事書的情節，充滿[成語]的想像，吸引我一直讀下去。" },
                { idiom: "交頭接耳", explanation: "形容兩個人湊近低聲說話。", sentence: "上課時要專心聽講，不要[成語]。" },
                { idiom: "力不從心", explanation: "心裡想做，力量卻辦不到。", sentence: "如果做事常常失敗，就會有[成語]的感覺。" },
                { idiom: "海底撈針", explanation: "比喻極難找到或極難辦到。", sentence: "如果不知道他的地址，要找到他，就像[成語]一樣困難。" }
            ],
            "第十二課 詠鵝": [
                { idiom: "千里鵝毛", explanation: "比喻禮物雖輕，但情意真摯。", sentence: "這份禮物雖然不貴重，卻是我[成語]的心意，請你一定要收下。" },
                { idiom: "一波三折", explanation: "比喻事情進行中遇到許多曲折。", sentence: "故事裡的英雄經過[成語]之後，終於打敗壞人救了大家。" },
                { idiom: "一鼓作氣", explanation: "形容鼓足勇氣，一口氣把事情做完。", sentence: "工作只剩下一點點了，我們[成語]把這些事做完再休息。" },
                { idiom: "首屈一指", explanation: "比喻最突出、最優秀。", sentence: "小彩是班上[成語]的熱心同學，常常主動幫助別人。" },
                { idiom: "身體力行", explanation: "親自體驗，努力實行。", sentence: "他聽了保護地球的故事之後，決定[成語]，從隨手關燈做起。" },
                { idiom: "形單影隻", explanation: "形容孤單無依。", sentence: "湖面上的天鵝獨來獨往，[成語]的，讓人覺得難過。" }
            ]
        };

        // =========================================================================
        // 遊戲狀態與工具函數
        // =========================================================================
        let currentLesson = null;
        let lessonIdioms = [];
        let currentQuestion = null;
        let allIdioms = Object.values(idiomData).flat().map(item => item.idiom);
        
        // 語音相關變數
        const synth = window.speechSynthesis;
        let chineseVoice = null; 

        // 隨機工具函數
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // 從陣列中隨機取出 n 個不重複的元素
        function getRandomElements(arr, n, excludeElement = null) {
            let tempArr = arr.filter(item => item !== excludeElement);
            shuffleArray(tempArr);
            return tempArr.slice(0, n);
        }

        // 語音初始化：載入中文語音
        function setupSpeechSynthesis() {
            if (!('speechSynthesis' in window)) {
                console.warn('瀏覽器不支援 Web Speech API。');
                return;
            }

            // 嘗試找到一個中文語音
            function populateVoiceList() {
                const voices = synth.getVoices();
                // 優先尋找台灣或普通話的中文語音
                chineseVoice = voices.find(voice => voice.lang === 'zh-TW' || voice.lang === 'zh-CN' || voice.lang.includes('zh'));
            }

            // Chrome/Edge 需要等待 voices 載入
            if (synth.onvoiceschanged !== undefined) {
                synth.onvoiceschanged = populateVoiceList;
            }
            populateVoiceList(); // 立即嘗試載入
        }

        // 朗讀成語 (Web Speech API)
        window.speakIdiom = function() {
            if (!currentQuestion || !synth) return;

            // 如果正在朗讀，先取消
            if (synth.speaking) {
                 synth.cancel();
            }

            const idiom = currentQuestion.idiom;
            const utterance = new SpeechSynthesisUtterance(idiom);
            
            // 設定語音，如果找到中文語音則使用，否則使用預設
            if (chineseVoice) {
                utterance.voice = chineseVoice;
            } else {
                utterance.lang = 'zh-TW'; // 嘗試指定中文
            }
            
            utterance.rate = 0.8; // 讀慢一點
            utterance.pitch = 1.0;

            synth.speak(utterance);
        }


        // 初始化: 生成課別按鈕
        function initLessonButtons() {
            const container = document.getElementById('lesson-buttons');
            Object.keys(idiomData).forEach(lessonName => {
                const button = document.createElement('button');
                button.className = 'bg-blue-500 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-blue-600 transition-colors option-button';
                button.textContent = lessonName.split(' ')[0]; // 只需要 "第一課", "第二課"
                button.onclick = () => selectLesson(lessonName);
                container.appendChild(button);
            });
        }

        // 選擇課別並開始挑戰
        function selectLesson(lessonName) {
            currentLesson = lessonName;
            lessonIdioms = [...idiomData[lessonName]]; // 複製一份，以便亂序和出題
            shuffleArray(lessonIdioms);

            document.getElementById('lesson-selection').classList.add('hidden');
            document.getElementById('challenge-area').classList.remove('hidden');
            document.getElementById('current-lesson').textContent = `正在挑戰：${lessonName}`;

            nextQuestion();
        }

        // 載入下一題
        function nextQuestion() {
            // 重置介面
            document.getElementById('idiom-explanation').textContent = ''; // 清空解釋
            document.getElementById('feedback-area').innerHTML = `<p id="message" class="text-xl font-bold text-gray-600">請從下方選項選出正確成語。</p>`;
            document.getElementById('next-button').classList.add('hidden');
            document.getElementById('speech-controls').classList.add('hidden'); // 隱藏語音按鈕

            if (synth && synth.speaking) {
                 synth.cancel(); // 停止朗讀
            }


            if (lessonIdioms.length === 0) {
                // 所有題目已完成
                document.getElementById('challenge-area').innerHTML = `
                    <div class="text-center p-10 bg-yellow-100 rounded-lg">
                        <p class="text-3xl font-extrabold text-yellow-700 mb-4">🎉 恭喜！完成本課所有挑戰！ 🎉</p>
                        <button class="bg-red-500 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-red-600 transition-colors mt-4" onclick="window.location.reload()">重新開始 / 選擇其他課別</button>
                    </div>
                `;
                return;
            }

            // 1. 取得下一題
            currentQuestion = lessonIdioms.pop();
            const correctIdiom = currentQuestion.idiom;
            
            // 2. 顯示解釋
            document.getElementById('idiom-explanation').textContent = currentQuestion.explanation;

            // 3. 替換造句中的方框
            const questionText = currentQuestion.sentence.replace(
                '[成語]', 
                Array(correctIdiom.length).fill('<span class="idiom-box">□</span>').join('')
            );
            
            document.getElementById('question-sentence').innerHTML = questionText;

            // 4. 準備選項
            const decoys = getRandomElements(allIdioms, 2, correctIdiom);
            const options = shuffleArray([correctIdiom, ...decoys]);
            
            const optionButtons = document.querySelectorAll('#options-area button');
            optionButtons.forEach((button, index) => {
                button.textContent = options[index];
                button.dataset.answer = options[index];
                button.classList.remove('bg-green-500', 'bg-red-700', 'hidden');
                button.classList.add('bg-red-500');
                button.disabled = false;
            });
        }

        // 檢查答案
        window.checkAnswer = function(selectedButton) {
            const allButtons = document.querySelectorAll('#options-area button');
            const selectedAnswer = selectedButton.dataset.answer;
            const correctAnswer = currentQuestion.idiom;
            
            // 禁用所有按鈕
            allButtons.forEach(btn => btn.disabled = true);

            if (selectedAnswer === correctAnswer) {
                // 答對邏輯
                selectedButton.classList.remove('bg-red-500');
                selectedButton.classList.add('bg-green-500');
                
                // 填入成語並高亮
                const filledSentence = currentQuestion.sentence.replace(
                    '[成語]', 
                    `<span class="idiom-filled">${correctAnswer}</span>`
                );
                
                document.getElementById('question-sentence').innerHTML = filledSentence;
                document.getElementById('feedback-area').innerHTML = `
                    <p class="text-2xl font-bold text-green-600">✅ 太棒了！答案正確！</p>
                    <p class="text-sm text-gray-500 mt-1">正確成語已顯示，您可以點擊下方按鈕朗讀。</p>
                `;
                document.getElementById('next-button').classList.remove('hidden');
                document.getElementById('speech-controls').classList.remove('hidden'); // 顯示語音按鈕
                
                // 自動朗讀正確成語
                speakIdiom();

            } else {
                // 答錯邏輯
                selectedButton.classList.remove('bg-red-500');
                selectedButton.classList.add('bg-red-700');
                document.getElementById('feedback-area').innerHTML = `
                    <p class="text-2xl font-bold text-red-700">❌ 答案錯誤，請再試一次。</p>
                    <button class="bg-gray-400 text-white py-2 px-4 rounded-lg mt-2 hover:bg-gray-500" onclick="resetOptions()">繼續嘗試</button>
                `;
                // 讓答錯的選項變透明
                setTimeout(() => {
                    selectedButton.classList.add('hidden');
                }, 500);
            }
        }

        // 重設選項 (答錯後繼續嘗試)
        window.resetOptions = function() {
            const allButtons = document.querySelectorAll('#options-area button');
            allButtons.forEach(btn => {
                if (!btn.classList.contains('bg-green-500')) {
                    btn.disabled = false;
                }
                document.getElementById('feedback-area').innerHTML = `<p id="message" class="text-xl font-bold text-gray-600">請從下方選項選出正確成語。</p>`;
            });
        }

        // 初始化整個應用
        window.onload = function () {
            initLessonButtons();
            setupSpeechSynthesis(); // 初始化瀏覽器語音功能
        };
    </script>
</body>
</html>
